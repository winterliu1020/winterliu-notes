### 1.DGA (**域名**生成算法)**是**一种利用随机字符来生成C&C**域名**，从而逃避**域名**黑名单检测的技术手段。

这个模型通过提取出最后一级域名，对最后一级域名进行特征提取。

特征工程的总体规划：1.只对最后一级域名进行字符分析（分析随机性） 2.增加无空格文本分词特征

统计维度，共4维：std_dev, avg, max, min

TLD + SLD: 共五维

```
- is_com = 0/1
- is_net = 0/1
- is_cn = 0/1
- is_club = 0/1
- is_org = 0/1
```

域名长度：共一维 text_dns_qry_name_len

随机性和熵：共一维

域名可读性：域名中包含的元音数目、包含的元音字母占整个域名的比例、域名中包含的数字数目、包含的数字占整个域名的比例、域名中包含的重复字母组合数。。。。

马尔科夫链转移概率：

WHOIS域名注册信息（谨慎使用）：

DNS Binding Record (未实现)：合法的DNS域名都会有对应的有效IP绑定记录。。非法的dga域名除了绑定了少量真实域名之外，其它的都是不存在的空域名。

ALEAX_RANK:

n-gram平均排名：

---

以上都是一些可以选择的特征，但是为了提高模型训练效率，需要进行特征选择。

PCA降维 （放弃）

特征重要性评估：使用GBDT算法进行特征重要性评估

第一轮 - 二分类，

---

最后还可以进行规则过滤，这里采用了好几种过滤方式：白名单、cdn、domain_levels过滤。。白名单也就是看域名在不在白名单里面，这里用的是Alexa-top排名，一般排名比较高的域名是没有问题的。

最最后设置一个阙值。





### 2.DNS Tunnel模型

计算的全是聚合特征，输入可以理解为数组，所要计算的特征：ip_type_ratio, dubdomain_avg_len, distinct_queries, distinct_query_ratio, entropy, meaningful_word_max_avglen。

首先从中心流量中提取请求域名字段, 根据注册域名进行分组，再根据时间窗口1h进行分组.孤立森林模型将根据每一行的六维特征给出预测结果, 并打上标签predict：1/-1

过滤脏数据：

从中心所提取的特征中, 发现有不少局域网域名混入在 dns 流量中. 现已尽可能的过滤该部分流量. 过滤规则如下:

- 过滤 subdomain_avg_len == 0 的流量
- 过滤解析出错的流量 (即非正常流量)
- 过滤结尾为 `.arpa` 的流量

总结：这个模型前部分和dga类似，都是从请求域名中获取需要的字段来作为特征（一部分特征），然后这里还多了一项提取隧道特征（另一部分特征）。

拿到了上面的特征之后然后开始预测：

- 隧道模型预测
- 过滤模型判白的流量
- 再过滤提供正常服务的域名的数据
- 过滤在aleaxtop中的域名数据

最后把过滤后的数据保存。









