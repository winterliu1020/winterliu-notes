#### 关于可重入性

可重入指的是可以`正确` `重复`使用。也就是当某个程序在任意一个时刻被操作系统中断，然后去执行另外一段代码，另外一段代码再去调用这个程序而不会出错。

可重入函数：不能含有一些全局的东西，也不能返回一些全局的东西。可重入函数用的都是函数调用者所提供的东西。

- 可重入性和线程安全的关系

  可重入性影响的是函数的外部接口，如果你要把不可重入函数变成可重入的，你需要更改函数的接口，让所有的数据都通过函数的调用者提供。而线程安全是修改函数实现部分，让它不会被几个线程同时访问。

可重入锁：也就是递归锁，同一线程外层函数获得锁之后，内层递归函数仍然能获得该锁。

#### CAS

保证了一致性、并发性。但是会不断重试，消耗CPU。而且只能保证一个变量的原子操作。还会带来ABA问题。

Atomic中一些类，比如AtomicInteger...就是用的CAS，这些类中调用的那些函数里面用的都是Unsafe类的函数，Unsafe类的函数都是native方法，因为这些函数都需要直接访问内存数据，而Java是无法直接访问内存的，所以需要通过这个Unsafe类。

而且Unsafe类中的函数都是CAS函数，比如你调用一个函数，虚拟机会帮你转成CAS汇编指令，这些指令在CPU上是原子执行的，不会被中断。所以说Unsafe类里面的函数都是依靠硬件来原子执行的。

CAS(this, valueOffset, oldValue, updateValue)